#include "dsk6713_aic23.h"	// Archivo de soporte para el códec DSK (poner la ruta)
#include "rbfN55FIR.cof"
Uint32 fs = DSK6713_AIC23_FREQ_8KHZ;	// Frecuencia de muestreo

/*#define N 55 //number of coefficients
float h[N] = { 1.7619E-017, 7.0567E-003, 2.2150E-018,-1.0962E-002, 4.0310E-017,
1.3946E-002, 7.1787E-018,-1.4588E-002, 3.9928E-017, 1.1474E-002,
5.9881E-018,-3.5159E-003,-6.6174E-018,-9.7476E-003,-1.7919E-017,
2.7932E-002,-9.4329E-017,-4.9740E-002, 3.3834E-017, 7.3066E-002,
-3.6228E-017,-9.5284E-002, 3.2194E-017, 1.1365E-001,-2.2165E-017,
-1.2576E-001, 7.8980E-018, 1.3000E-001, 7.8980E-018,-1.2576E-001,
-2.2165E-017, 1.1365E-001, 3.2194E-017,-9.5284E-002,-3.6228E-017,
7.3066E-002, 3.3834E-017,-4.9740E-002,-9.4329E-017, 2.7932E-002,
-1.7919E-017,-9.7476E-003,-6.6174E-018,-3.5159E-003, 5.9881E-018,
1.1474E-002, 3.9928E-017,-1.4588E-002, 7.1787E-018, 1.3946E-002,
4.0310E-017,-1.0962E-002, 2.2150E-018, 7.0567E-003, 1.7619E-017 };
*/

/*
#define N 61 //number of coefficients
float h[N] = { 0.0282775982399016446999784335503,-0.00705950711750478413636367136519,
	-0.00569615069258064873197744404365,-0.00410019887199578741965311223794,
	-0.00220153245123341084754642338339,7.07403931641386869537402315444e-05,
	0.00277829305781740476533059336361,0.005934908869885045096248532559,
	0.0095205380652397877949688620447,0.0134330513367845010008760908704,
	0.01753204933710135471347513203,0.0215980431610028576761006746665,
	0.0253613091862244025009864856202,0.0285019502350159215087188613325,
	0.0307055185032703951975019407428,0.0316673265975335183064487409865,
	0.0311885245581525402669420543589,0.0290018208187839340861380321712,
	0.0250360907568514916288204830153,0.019339705444384149707337527957,
	0.0119652621503709491457279057158,0.00321275972270576712017109421993,
	-0.00661511622363374334615526706216,-0.0170479436677619215767531812844,
	-0.0276126035643661643659285687136,-0.0377459320018363742033074004212,
	-0.0469506385758555813692005642679,-0.0546841597942745241689443957966,
	-0.0605595193704882503449304920196,-0.0642131246360927304683841043698,
	0.934540754046446320302266030922,-0.0642131246360927304683841043698,
	-0.0605595193704882503449304920196,-0.0546841597942745241689443957966,
	-0.0469506385758555813692005642679,-0.0377459320018363742033074004212,
	-0.0276126035643661643659285687136,-0.0170479436677619215767531812844,
	-0.00661511622363374334615526706216,0.00321275972270576712017109421993,
	0.0119652621503709491457279057158,0.019339705444384149707337527957,
	0.0250360907568514916288204830153,0.0290018208187839340861380321712,
	0.0311885245581525402669420543589,0.0316673265975335183064487409865,
	0.0307055185032703951975019407428,0.0285019502350159215087188613325,
	0.0253613091862244025009864856202,0.0215980431610028576761006746665,
	0.01753204933710135471347513203,0.0134330513367845010008760908704,
	0.0095205380652397877949688620447,0.005934908869885045096248532559,
	0.00277829305781740476533059336361,7.07403931641386869537402315444e-05,
	-0.00220153245123341084754642338339,-0.00410019887199578741965311223794,
	-0.00569615069258064873197744404365,-0.00705950711750478413636367136519,
	0.0282775982399016446999784335503 };
 */
//declaración de vectores y variables globales
float x[N];
float yy;
int y, xx, k, m;

interrupt void c_int11()	//Rutina del servicio de interrupción
{
	//declaración de vectores y variables locales
	xx = input_sample(); //Lectura de una muestra del códec
	x[0] = (float)xx;

	// ************** coloque aquí la rutina de filtrado de filtrado FIR **************
	yy = 0;
	for (k = 0; k <= N - 1; k++)
	{
		yy = yy + h[k] * x[k];
	}
	for (m = N - 1; m > 0; m--)
	{
		x[m] = x[m - 1];
	}

	y = (int)yy;
	output_sample(y >> 15);	//Envío de la muestra filtrada hacia el códec
	return;
}

void main()
{
	comm_intr();	//Inicializar el codec, DSK y McBSP
	while (1);	//Bucle infinito a la espera de una interrupción
}
