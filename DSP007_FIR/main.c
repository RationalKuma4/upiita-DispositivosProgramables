#include "dsk6713_aic23.h"                                                 // Archivo de soporte para el códec DSK (poner la ruta)
Uint32 fs=DSK6713_AIC23_FREQ_16KHZ;                       // Frecuencia de muestreo
//#include "rbfN_FIR.cof"
//DSP04_codec_melod.c
#include "dsk6713.h"
#include "math.h"
#include "dsk6713_dip.h"

//#define N 125
//float h[N]= {-0.0104274985335595,-0.00196192178262162,-0.00191461444208016,-0.00169154752241097,-0.00128226782016701,-0.000684172414826152,9.30803346951397e-05,0.00103005238537742,0.00209336777080511,0.00324139820358747,0.00441940731716183,0.00556835023867672,0.00662161644751706,0.00750995767498180,0.00816972553966165,0.00853826899084741,0.00856450906834539,0.00821011711434930,0.00745213633641073,0.00628567789775659,0.00472620977276104,0.00281080111444309,0.000596958667659049,-0.00183747268053178,-0.00439766820273840,-0.00697462735457460,-0.00945180673755057,-0.0117062431065370,-0.0136233900501934,-0.0150909870848112,-0.0160156791966788,-0.0163164570622699,-0.0159419930713780,-0.0148643057620406,-0.0130976969418607,-0.0106803699084346,-0.00769017295507738,-0.00420555674170852,-0.000378391354163762,0.00364303134978071,0.00770989380177847,0.0116279333668977,0.0152373763597668,0.0183604188996268,0.0208533384332365,0.0225808360886656,0.0234503292753545,0.0233925081194473,0.0223906676288659,0.0204520117764371,0.0176476220951487,0.0140652108811340,0.00984480633276840,0.00515023054357103,0.000172482430408481,-0.00488860769574251,-0.00981845500790233,-0.0144119668769191,-0.0184710286485746,-0.0218262177386630,-0.0243310547900173,-0.0258801276041552,0.973596380279197,-0.0258801276041552,-0.0243310547900173,-0.0218262177386630,-0.0184710286485746,-0.0144119668769191,-0.00981845500790233,-0.00488860769574251,0.000172482430408481,0.00515023054357103,0.00984480633276840,0.0140652108811340,0.0176476220951487,0.0204520117764371,0.0223906676288659,0.0233925081194473,0.0234503292753545,0.0225808360886656,0.0208533384332365,0.0183604188996268,0.0152373763597668,0.0116279333668977,0.00770989380177847,0.00364303134978071,-0.000378391354163762,-0.00420555674170852,-0.00769017295507738,-0.0106803699084346,-0.0130976969418607,-0.0148643057620406,-0.0159419930713780,-0.0163164570622699,-0.0160156791966788,-0.0150909870848112,-0.0136233900501934,-0.0117062431065370,-0.00945180673755057,-0.00697462735457460,-0.00439766820273840,-0.00183747268053178,0.000596958667659049,0.00281080111444309,0.00472620977276104,0.00628567789775659,0.00745213633641073,0.00821011711434930,0.00856450906834539,0.00853826899084741,0.00816972553966165,0.00750995767498180,0.00662161644751706,0.00556835023867672,0.00441940731716183,0.00324139820358747,0.00209336777080511,0.00103005238537742,9.30803346951397e-05,-0.000684172414826152,-0.00128226782016701,-0.00169154752241097,-0.00191461444208016,-0.00196192178262162,-0.0104274985335595};

/*#define N 61 //number of coefficients
float h[N] = { 0.0282775982399016446999784335503,-0.00705950711750478413636367136519,
               -0.00569615069258064873197744404365,-0.00410019887199578741965311223794,
               -0.00220153245123341084754642338339,7.07403931641386869537402315444e-05,
               0.00277829305781740476533059336361,0.005934908869885045096248532559,
               0.0095205380652397877949688620447,0.0134330513367845010008760908704,
               0.01753204933710135471347513203,0.0215980431610028576761006746665,
               0.0253613091862244025009864856202,0.0285019502350159215087188613325,
               0.0307055185032703951975019407428,0.0316673265975335183064487409865,
               0.0311885245581525402669420543589,0.0290018208187839340861380321712,
               0.0250360907568514916288204830153,0.019339705444384149707337527957,
               0.0119652621503709491457279057158,0.00321275972270576712017109421993,
               -0.00661511622363374334615526706216,-0.0170479436677619215767531812844,
               -0.0276126035643661643659285687136,-0.0377459320018363742033074004212,
               -0.0469506385758555813692005642679,-0.0546841597942745241689443957966,
               -0.0605595193704882503449304920196,-0.0642131246360927304683841043698,
               0.934540754046446320302266030922,-0.0642131246360927304683841043698,
               -0.0605595193704882503449304920196,-0.0546841597942745241689443957966,
               -0.0469506385758555813692005642679,-0.0377459320018363742033074004212,
               -0.0276126035643661643659285687136,-0.0170479436677619215767531812844,
               -0.00661511622363374334615526706216,0.00321275972270576712017109421993,
               0.0119652621503709491457279057158,0.019339705444384149707337527957,
               0.0250360907568514916288204830153,0.0290018208187839340861380321712,
               0.0311885245581525402669420543589,0.0316673265975335183064487409865,
               0.0307055185032703951975019407428,0.0285019502350159215087188613325,
               0.0253613091862244025009864856202,0.0215980431610028576761006746665,
               0.01753204933710135471347513203,0.0134330513367845010008760908704,
               0.0095205380652397877949688620447,0.005934908869885045096248532559,
               0.00277829305781740476533059336361,7.07403931641386869537402315444e-05,
               -0.00220153245123341084754642338339,-0.00410019887199578741965311223794,
               -0.00569615069258064873197744404365,-0.00705950711750478413636367136519,
               0.0282775982399016446999784335503 };
*/
#define N 100
float h[N]={0.841128472,-0.2869288656,-0.2257630666,-0.1666200609,-0.1114970215,-0.06197917798,-0.01921871729,0.0160660783,0.04357313401,
            0.06338267128,0.07590995262,0.08184791448,0.08210311547,0.07772845688,0.06985600541,0.05963298016,0.04816357761,0.03645882601,
            0.02539611128,0.01568943095,0.007870839839,0.002282979766,-0.0009179393578,-0.00174979562,-0.0003843074341,0.002879386567,
            0.007645420943,0.01345420899,0.0198158389,0.02624207175,0.03227536511,0.03751362332,0.04162969834,0.04438501479,0.04563704989,
            0.04534074459,0.04354423913,0.04037960141,0.03604943627,0.03081042283,0.02495491886,0.01879179694,0.01262763849,0.006749315897,
            0.001408847648,-0.003188772056,-0.006894277272,-0.009619099008,-0.0113365534,-0.01207941641,-0.01193424226,-0.01103294215,
            -0.009542261054,-0.007651869912,-0.005561825884,-0.003470145224,-0.001561185018,4.554040942e-06,0.00109870471,0.001631025192,
            0.001552888252,0.000858200719,-0.0004181666414,-0.002204224384,-0.004396654644,-0.006868124832,-0.009475639754,-0.01206941363,
            -0.01450174031,-0.01663536557,-0.01835091738,-0.0195530233,-0.02017483491,-0.02018078046,-0.01956747343,-0.01836280957,-0.01662338388,-0.01443044483,-0.01188467428,-0.009100132099,-0.00619773538,-0.003298650412,-0.0005179631254,0.002041038234,0.004291683257,0.006167619499,0.007625241235,0.008644771949,0.009230002753,0.009406762415,0.009220260648,0.008731501608,0.008013006598,0.007144112044,0.006206120211,0.005277575811,0.004429922668,0.003723762594,0.003205895891,0.002907272274};
//declaración de vectores y variables globales
float x[N];
int n = 0;
float yy;
int y, k, m;

/*interrupt void c_int11()                               //Rutina del servicio de interrupción
{
    //declaración de vectores y variables locales
    x[0]=input_sample();                            //Lectura de una muestra del códec

    // ************** coloque aquí la rutina de filtrado de filtrado FIR **************

    yy=0;
    for (k=0; k < N; k++) {
        yy=yy+h[k]*x[k];
    }

    for (m=N-1; m >= 1; m--) {
        x[m]=x[m-1];
    }

    y=(int) yy;
    //output_sample(y>>15);    //Envío de la muestra filtrada hacia el códec


    if (DSK6713_DIP_get(0) == 0)
    {
        output_sample((int)x[0]>>15);    //Envío de la muestra filtrada hacia el códec
    }
    else if (DSK6713_DIP_get(1) == 0)
    {
        output_sample(y>>15);  //Envío de la muestra filtrada hacia el códec
    }
    else
    {
        output_sample(0);
    }

    return;
}*/
void main()
{

    comm_poll();    // Inicializar el codec, DSK y McBSP
    DSK6713_DIP_init();
    DSK6713_init();
    while (1)       // Bucle infinito a la espera de una interrupción
    {
        //declaración de vectores y variables locales
        x[0]=input_sample();                            //Lectura de una muestra del códec

        // ************** coloque aquí la rutina de filtrado de filtrado FIR **************

        yy=0;
        for (k=0; k < N; k++) {
            yy=yy+h[k]*x[k];
        }

        for (m=N-1; m >= 1; m--) {
            x[m]=x[m-1];
        }

        y=(int) yy;
        //output_sample(y>>15);    //Envío de la muestra filtrada hacia el códec


        if (DSK6713_DIP_get(0) == 0)
        {
            output_sample((int)x[0]>>15);    //Envío de la muestra filtrada hacia el códec
        }
        else if (DSK6713_DIP_get(1) == 0)
        {
            output_sample(y>>15);  //Envío de la muestra filtrada hacia el códec
        }
        else
        {
            output_sample(0);
        }
    }
    /*comm_intr();               //Inicializar el codec, DSK y McBSP
    DSK6713_DIP_init();
    while(1);                      //Bucle infinito a la espera de una interrupción*/
}
